<!--
    Copyright (C) 2016 Matteo Nastasi <nastasi@alternativeoutput.it>

    This file is part of recursor.

    png2apng is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Foobar is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Foobar.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
<head>
<title>Recursor test page.</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style>

table {
    border-collapse: collapse;
}

td {
    border: 1px solid black;
    padding: 0px;
    text-align: center;
}
</style>
<script type="text/javascript" src="recursor.js"></script>
</head>
<body>
<table>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: alias;">alias</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: all-scroll;">all-scroll</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: auto;">auto</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: cell;">cell</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: context-menu;">context-menu</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: col-resize;">col-resize</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: copy;">copy</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: crosshair;">crosshair</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: default;">default</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: e-resize;">e-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: ew-resize;">ew-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: grab;">grab</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: grabbing;">grabbing</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: help;">help</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: move;">move</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: n-resize;">n-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: ne-resize;">ne-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: nesw-resize;">nesw-resize</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: ns-resize;">ns-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: nw-resize;">nw-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: nwse-resize;">nwse-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: no-drop;">no-drop</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: none;">none</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: not-allowed;">not-allowed</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: pointer;">pointer</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: progress;">progress</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: row-resize;">row-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: s-resize;">s-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: se-resize;">se-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: sw-resize;">sw-resize</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: text;">text</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: URL;">URL</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: vertical-text;">vertical-text</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: w-resize;">w-resize</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: wait;">wait</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: zoom-in;">zoom-in</td>
</tr>
<tr>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: zoom-out;">zoom-out</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: initial;">initial</td>
<td style="width: 200px; height: 100px; background-color: #f0e0e0; cursor: inherit;">inherit</td>
</tr>
</table>
</table>
</body>
<script>

var cursor_cur = "";

function getStyle(el, styleProp) {
  var value, defaultView = (el.ownerDocument || document).defaultView;
  // W3C standard way:
  if (defaultView && defaultView.getComputedStyle) {
    // sanitize property name to css notation
    // (hypen separated words eg. font-Size)
    styleProp = styleProp.replace(/([A-Z])/g, "-$1").toLowerCase();
    return defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
  } else if (el.currentStyle) { // IE
    // sanitize property name to camelCase
    styleProp = styleProp.replace(/\-(\w)/g, function(str, letter) {
      return letter.toUpperCase();
    });
    value = el.currentStyle[styleProp];
    // convert other units to pixels on IE
    if (/^\d+(em|pt|%|ex)?$/i.test(value)) { 
      return (function(value) {
        var oldLeft = el.style.left, oldRsLeft = el.runtimeStyle.left;
        el.runtimeStyle.left = el.currentStyle.left;
        el.style.left = value || 0;
        value = el.style.pixelLeft + "px";
        el.style.left = oldLeft;
        el.runtimeStyle.left = oldRsLeft;
        return value;
      })(value);
    }
    return value;
  }
}


// Temporary variables to hold mouse x-y pos.s

var IE = false;
// Main function to retrieve mouse x-y pos.s

function getMouseXY(e) {
  console.log("getMouseXY");
  var tempX = 0;
  var tempY = 0;
  if (IE) { // grab the x-y pos.s if browser is IE
    tempX = event.clientX + document.body.scrollLeft
    tempY = event.clientY + document.body.scrollTop
  } else {  // grab the x-y pos.s if browser is NS
    tempX = e.pageX
    tempY = e.pageY
  }  
  // catch possible negative values in NS4
  if (tempX < 0){tempX = 0}
  if (tempY < 0){tempY = 0}  
  // show the position values in the form named Show
  // in the text fields named MouseX and MouseY

  recursor.move(tempX, tempY);

  return true
}

var ptrstore_img = null;
function tdclick_cb()
{
    if (ptrstore_img == null) {
        ptrstore_img = recursor.img_get();
        recursor.img_set("none");
    }
    else {
        recursor.img_set(ptrstore_img);
        ptrstore_img = null;
    }
}


function mouseover_cb(e){
    console.log("mouseover_cb");
    name_cur = getStyle(e.target, 'cursor');
    if (name_cur == 'auto')
        return;

    if (name_cur in Recursor.cursors) {
        ptrstore_img = null;
        recursor.img_set(name_cur);

        if (Recursor.cursors[name_cur].dx != 0 || Recursor.cursors[name_cur].dy != 0)
            e.target.style.backgroundColor = 'green';
        else {
              console.log('zz:' + recursor.src_get());
            if (recursor.src_get() == "out/24px/todo.png") {
                e.target.style.backgroundColor = 'red';
            }
            else {
                e.target.style.backgroundColor = 'orange';
            }
        }
    }
    else {
        recursor.img_set("progress");
        ptrstore_img = null;
    }

    console.log( name_cur );
}



var recursor = null;
window.onload = function () {

    var body = document.getElementsByTagName("body");
    body = body[0];
    body.onmouseover = mouseover_cb;

    document.onmousemove = getMouseXY;
    recursor = new Recursor(0, 0, "none");
    console.log(recursor);
    var tds = document.getElementsByTagName('td');

    for(var i = 0 ; i < tds.length ; i++) {
        tds[i].onclick = tdclick_cb;
    }
}
</script>
</html>
